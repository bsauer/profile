DATE=`date +%Y%m%d%H%M%S`
PROFILE_REPO="https://github.com/bsauer/profile.git"
PROFILE_DIR="$HOME/.profile.d"
SAVE_PROFILE_DIR="$HOME/.profile.d.${DATE}"

if ! type -p git; then
  echo
  echo "'git' command not found. Please install git first."
  exit 1
fi

#cd "$HOME"

if [ -d $PROFILE_DIR ]; then
  echo 
  echo "Moving current $PROFILE_DIR to $SAVE_PROFILE_DIR"
  mv $PROFILE_DIR $SAVE_PROFILE_DIR
fi

mkdir $PROFILE_DIR
echo
git clone $PROFILE_REPO $PROFILE_DIR/core

if [ -L $HOME/.profile ]; then
  echo
  echo "Removing current $HOME/.profile link."
  rm $HOME/.profile 
elif [ -f $HOME/.profile ]; then
  echo
  echo "Moving current $HOME/.profile to $PROFILE_DIR/userprofile.conf"
  mv $HOME/.profile $PROFILE_DIR/userprofile.conf
fi

ln -s $PROFILE_DIR/core/init .profile

for BLOCKING_RC in $HOME/.bashrc $HOME/.login $HOME/.bashprofile $HOME/.bash_profile; do
  if [ -f $BLOCKING_RC ]; then
    echo
    echo "Warning: Found existing $BLOCKING_RC which may cause .profile not to load."
    echo "You may want to move this file into a $PROFILE_DIR/$BLOCKING_RC.conf file."
  fi
done

echo
